import tkinter as tk
from tkinter import filedialog, messagebox
import hashlib
import requests
import os


# Function to calculate file hash (MD5)
def calculate_md5(file_path):
    hasher = hashlib.md5()
    with open(file_path, 'rb') as f:
        while chunk := f.read(8192):
            hasher.update(chunk)
    return hasher.hexdigest()


# Function to query VirusTotal
def check_virustotal(file_hash):
    api_key = 'YOUR_VIRUSTOTAL_API_KEY'  # Replace with your API key
    url = f"https://www.virustotal.com/vtapi/v2/file/report"
    params = {'apikey': api_key, 'resource': file_hash}
    response = requests.get(url, params=params)

    if response.status_code == 200:
        return response.json()
    else:
        return None


# Function triggered by 'Upload File' button
def upload_file():
    file_path = filedialog.askopenfilename()

    if not file_path:
        return

    try:
        # Calculate the file hash
        file_hash = calculate_md5(file_path)
        file_info_label.config(text=f"File: {os.path.basename(file_path)}\nMD5 Hash: {file_hash}")

        # Check VirusTotal
        vt_response = check_virustotal(file_hash)

        if vt_response and vt_response.get('positives'):
            total = vt_response['total']
            positives = vt_response['positives']
            result_label.config(text=f"VirusTotal Detections: {positives}/{total}")
        else:
            result_label.config(text="No VirusTotal report available for this file.")

    except Exception as e:
        messagebox.showerror("Error", str(e))


# GUI setup with Tokyo Night theme
root = tk.Tk()
root.title("Malware Analysis Tool")

# Set window background color
root.configure(bg="#1a1b26")

# Upload button with Tokyo Night style
upload_button = tk.Button(root, text="Upload File", command=upload_file,
                          bg="#7aa2f7", fg="#1a1b26", font=("Arial", 12, "bold"))
upload_button.pack(pady=10)

# File info label with Tokyo Night style
file_info_label = tk.Label(root, text="No file uploaded.", bg="#1a1b26",
                           fg="#c0caf5", font=("Arial", 10))
file_info_label.pack(pady=10)

# Result label with Tokyo Night style
result_label = tk.Label(root, text="", bg="#1a1b26", fg="#9ece6a", font=("Arial", 10, "italic"))
result_label.pack(pady=10)

# Footer with "Made by Oussama"
footer_label = tk.Label(root, text="Made by Oussama", bg="#1a1b26",
                        fg="#7aa2f7", font=("Arial", 9, "bold"))
footer_label.pack(side="bottom", pady=10)

# Start the GUI loop
root.geometry("400x250")
root.mainloop()
